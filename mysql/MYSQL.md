mysql 引擎主要分为两种 InnoDB 和 MyISAM

mysql 里面的索引结构主要是 B树和B+树

B树:
    定义了 二元组 [key, data], key 就是索引的值
    每个结点都有 key 域 和 data 域
    每个结点 首尾都是指针 中间是 key 交替出现 例如 {p1 key1 p2 key2 p3}
    d > 1 为B树的度
    h 为树的高
    非叶子节点都有 n - 1 个 key, n 个指针       d <= n <= 2d
    叶子结点至少有 1个 key、2 个指针, 最多有 2d - 1 个 key, 2d 个指针, 叶子结点
    指针要么是指向另外一个结点 要么就是 null
    每个结点的域的个数和所占空间是一样的, 虽然 key 的数量和 指针的数量不同
    叶子结点的顺序从左到右 key 值是非递减的


B+树: 也是二元组 [key, data]
    非叶子节点只有 key, 叶子结点才既有 key, 又有 data。换句话说 data 只保留在叶子节点中
    所以每个结点所占的空间也是不一样的
    每个结点的指针上限为 2d 而不是 2d + 1    
    结点的最左边是 key key 和 指针交替出现
    叶子节点的指针全是 null
    有时候为了增加查询效率会在叶子节点增加一个指针指向右边的结点
    更适合外存索引 因为和 内结点的出度有关 dmax = floor(pageSize / (keySize + dataSize + PointSize))

为什么不用红黑树 因为红黑树的深度比较高 h 比较大
而 B树的 O(h) = log d ((N + 1) / 2) ~ O(log d N)
而且通常由于 d 比较大 所以 h 的高度都不会超过 3 层 查询效率比较高

MyISAM: 通常情况下也是大部分使用的是 B+ 树作为索引结构，不过里面的索引都是非聚集索引
MyISAM 可以没有主键
索引的存储方式 索引里面 data 存的是数据的地址，所以说相当于是 数据文件 和 索引文件是分开存储的
主索引和辅助索引的区别不大 data 域存的都是数据的地址。 主索引要求 key 不能重复, 辅助索引的 key 可以重复
所以查询的过程是 判断使用的是什么索引 然后找到对应的 key 对应的 data, 最后根据 data(地址) 去查询对应的数据

InnoDB: 也是 B+树 作为索引结构, 但是和 MyISAM 不同的是
InnoDB 本身的数据文件就是一个索引文件, 所以相当于是 主索引文件当中就保存所有的数据 这种索引又叫聚集索引
InnoDB 数据文件本身就是主索引
InnoDB 一定会有主键 如果没有定义主键 那么会选择出唯一标识的列作为主键 如果实在没有主键 那么就会自动生成一个隐藏字段 6 个字节的长整形作为主键
辅助索引 data 域存的是主键的值, 也就是说辅助索引引用了主键, 这也就是为什么不建议主键过长，因为这种也会导致辅助索引大小变大，从磁盘中加载回来的速度会变低
所以查询的过程是 有辅助索引的情况下 通过 key 查询到对应的 data(主键) 然后再去 主索引中查询对应的数据

磁盘中一般数据是页单位存储的 常见的操作系统一页的大小是 4k


组合索引 最左前缀原则
index(a, b, c)
1. where a = ? and b = ? and c = ? 全部匹配走索引
2. where a = ? and c = ? 只走了 a 索引
3. where b = ? and c = ? 一个都不走索引


范围查询走索引 只有一个范围查询会走索引, 所以不可能出现两个范围查询都走索引
范围查询走索引，后面的列都不会走索引了
要搞清楚范围查询和多值匹配的区别 并不是说 between and 就一定是范围查询，还要结合具体使用到索引 索引长度
in() 有很多情况下会是多值匹配
前缀索引兼顾 查询速度 和 索引大小 但是缺点是不能用于 order by 和 group 操作, 也不能用于 covering index(即当索引本身包含查询所需全部数据时，不再访问数据文件本身)

InnoDB 各条数据按主键顺序存放, 没插入一条新的数据会放入合适的结点和位置, 如果页面达到装载因子(InnoDB 默认 15 / 16), 则开辟一个新的页(结点)
因为磁盘读取采用预读的策略, 所以将结点的大小设置为页的大小, 这样读取一个页就只需要一次 I/O



start.
